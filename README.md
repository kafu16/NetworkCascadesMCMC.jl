# NetworkCascadesMCMC

[![Dev](https://img.shields.io/badge/docs-dev-blue.svg)](https://kafu16.github.io/NetworkCascadesMCMC.jl/)

NetworkCascadesMCMC.jl is for sampling flow networks that are vulnerable for cascading failures using the MCMC method simulated annealing. Networks of arbitrary topology can be used. The in- and outflow at the vertices of the networks can also be of arbitrary choice while the flow has to be conserved.<br/>
Furthermore, networks can be examined using different measurements such as the locality of the edge failures or the number of edges between generators and consumers.

## Further Features
Implemented grid topologies:
 - square grid
 - square grid with periodic boundaries
 - grids generated by SyntheticNetworks.jl

Implemented flow pattern
 - Randomly chosen equal number of in- an outflows that are either +1 or -1.

NetworkCascadesMCMC.jl comprises further non-documented postprocessing and graph visualization features.

## Installation
 - Install NetworkCascadesMCMC.jl: `pkg> add https://github.com/kafu16/NetworkCascadesMCMC.jl.git`
 - Get recent version of NetworkCascadesMCMC.jl: `pkg> update NetworkCascadesMCMC`

## Example Usage
The following is a simple example script.
At first, the parameters are initialized. Then, in the directory where the script is executed a folder /data is created and for each execution another subfolder is generated named by date and time of the execution and selected parameters. Within this subfolder multiple files are generated in this script containing the data of the core simulation, postprocessing data and plots:
 - simulation_data.jld: energy of each iteration step of the simulated annealing algorithm
 - postprocess_data.jld: all the postprocessing data.
 - params_postprocess.txt: mean values of postprocessing data
 - data_postprocess.csv: overview of selected postprocessing data
 - decreasing_Gav_av.pdf: plot of avearage of G_av of all runs
 - decreasing_G_av_sample.pdf: G_av of one single run
 - flows_rand_min_Gav.pdf: histogram comparing flows of initial grids and sampled grids.

```julia
using NetworkCascadesMCMC

using Dates
using JLD
using CSV
using LightGraphs

# initialization of parameters
N_side = 8
C = 1.
steps_per_temp = 1 # number of steps before lowering temperature
k_max = 10
annealing_schedule = temp_ex3_a
annealing_schedule_name = "2_0.99^k"  # for storing annealing schedule in .jld
N_runs = 4
T = 0.95
Run_Nr = 1

rng_seed = 321
rpg_seed = 123
n = 64
n0 = 32
p = 0.999
q = 0.44
r = 0.3
s = 0.28

# creating data folder
repo_directory = pwd()
t=now()
datetime = Dates.format(t, "yyyymmdd_HHMMSS.s") # https://riptutorial.com/julia-lang/example/20476/current-time
folder = string("data/",datetime,"_N_runs",string(N_runs),"_k_max",string(k_max),"_ann_sched",string(annealing_schedule_name))
directory = string(repo_directory,"/data/",datetime,"_N_runs",string(N_runs),"_k_max",string(k_max),"_ann_sched",string(annealing_schedule_name))
mkpath(folder)
cd(directory)

# grid topology
g = gen_square_grid(N_side)
# alternative grid topologies:
# g = gen_periodic_square_grid(N_side)
# g = gen_rand_grid(rpg_seed, n, n0, p, q, r, s)

# flow patterns
P_inits = gen_multiple_stable_configs(g, C, N_runs)

# core simulation
simulation_data = string(directory,"/simulation_data.jld")
multiple_sim_anneal(simulation_data, g, P_inits, C, annealing_schedule, annealing_schedule_name, steps_per_temp, k_max, N_runs)

# postprocessing
postprocess_data = string(directory,"/postprocess_data.jld")
postprocess_sim_anneal(simulation_data, postprocess_data, T)
Data_loaded = JLD.load(postprocess_data)
filename = "params_postprocess.txt"
write_out_params(Data_loaded, filename)
write_out_postprocess(Data_loaded, filename)
df = df_postprocessing(Data_loaded)
CSV.write(string(directory,"/data_postprocess.csv"), df)

# plotting
plot_Gav_av(Data_loaded)
plot_histogram_all_runs(Data_loaded)
Run_Nr = 1; plot_Gav_single_run(Data_loaded, Run_Nr)

cd(repo_directory)
```
